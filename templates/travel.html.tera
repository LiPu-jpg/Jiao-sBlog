{% extends "base" %}
{% block title %}è¶³è¿¹{% endblock title %}

{% block content %}
<div class="card">
    <h1>ğŸ—º æˆ‘çš„æ—…è¡Œè¶³è¿¹</h1>
    <p style="text-align: center; margin-bottom: 30px; color: var(--text-secondary);">
        åœ¨è¿™é‡Œï¼Œæˆ‘è®°å½•äº†è‡ªå·±èµ°è¿‡çš„åŸå¸‚å’Œå›½å®¶ï¼Œç•™ä¸‹ç¾å¥½çš„æ—…è¡Œå›å¿†
    </p>
    
    <!-- åœ°å›¾å®¹å™¨ -->
    <div id="container" style="width:100%; height:500px; border-radius:12px; overflow:hidden; box-shadow: var(--shadow-light);"></div>
    
    <div style="margin-top: 30px; padding: 25px; background: rgba(46, 204, 113, 0.1); border-radius: 12px; border-left: 4px solid #2ecc71;">
        <h3 style="margin-bottom: 15px; color: #2c3e50;">ğŸŒ æ—…è¡Œç»Ÿè®¡</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-top: 20px;">
            <div style="text-align: center;">
                <div style="font-size: 2rem; font-weight: bold; color: #2ecc71;">15+</div>
                <div style="color: var(--text-secondary);">è®¿é—®åŸå¸‚</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 2rem; font-weight: bold; color: #3498db;">8+</div>
                <div style="color: var(--text-secondary);">å›½å®¶/åœ°åŒº</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 2rem; font-weight: bold; color: #e74c3c;">1000+</div>
                <div style="color: var(--text-secondary);">æ—…è¡Œç…§ç‰‡</div>
            </div>
        </div>
    </div>
</div>

<script>
// åˆå§‹åŒ–å‡½æ•°
function init() {
    var map = new BMapGL.Map("container");
    var center = new BMapGL.Point(116.404, 39.915);
    map.centerAndZoom(center, 5);
    map.enableScrollWheelZoom(true);
    map.setMapStyleV2({
        styleId: '3d71d8b7f1f8d4b7f8d4b7f8d4b7f8d4'
    });

    fetch("/static/foots.json")
        .then(r => r.json())
        .then(data => {
            data.forEach(e => {
                let point = new BMapGL.Point(e.latLng[0], e.latLng[1]);
                let marker;

                if (e.icon) {
                    let myIcon = new BMapGL.Icon(e.icon, new BMapGL.Size(26,26));
                    marker = new BMapGL.Marker(point, { icon: myIcon });
                } else {
                    marker = new BMapGL.Marker(point);
                }

                map.addOverlay(marker);

                let content = "";
                if (e.photo) {
                    content += "<div style='display:flex;flex-wrap:wrap;'>";
                    e.photo.forEach(p => {
                        content += `<img src="${p}" style="width:48%; margin:2px; border-radius:6px;">`;
                    });
                    content += "</div>";
                }
                content += `<p style='padding:8px 0;'>${e.desc ?? ""}</p>`;

                let infoWindow = new BMapGL.InfoWindow(content, {
                    width: 320,
                    title: e.name,
                    enableCloseOnClick: true,
                    enableMessage: false
                });

                marker.addEventListener("click", () => {
                    map.openInfoWindow(infoWindow, point);
                });
            });
        })
        .catch(error => {
            console.error('åŠ è½½è¶³è¿¹æ•°æ®å¤±è´¥:', error);
            document.getElementById('container').innerHTML = 
                '<div style="display: flex; justify-content: center; align-items: center; height: 100%; color: #7f8c8d; font-size: 1.1rem;">åœ°å›¾æ•°æ®åŠ è½½ä¸­...</div>';
        });
}

// å¼‚æ­¥åŠ è½½ç™¾åº¦åœ°å›¾
(function loadScript(){
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "//api.map.baidu.com/api?type=webgl&v=1.0&ak=1MRi7rLmltAZS399xnqlRxjAHtZ3uPRa&callback=init";
    script.onerror = function() {
        document.getElementById('container').innerHTML = 
            '<div style="display: flex; justify-content: center; align-items: center; height: 100%; color: #e74c3c;">åœ°å›¾åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</div>';
    };
    document.body.appendChild(script);
})();
</script>
{% endblock content %}